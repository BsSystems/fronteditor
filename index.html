<!doctype html>
<html>
    <head>
        <title>Frontend Playground</title>
        <link rel="stylesheet" type="text/css" href="/lib/codemirror.css">
        <link rel="stylesheet" type="text/css" href="/lib/dracula.css">
        <link rel="stylesheet" type="text/css" href="/lib/hint/show-hint.css">
        <script src="/lib/codemirror.js" ></script>
        <script src="/lib/mode/htmlmixed/htmlmixed.js" ></script>
        <script src="/lib/mode/xml/xml.js" ></script>
        <script src="/lib/mode/css/css.js" ></script>
        <script src="/lib/mode/javascript/javascript.js" ></script>
        <script src="/lib/hint/anyword-hint.js" ></script>
        <script src="/lib/hint/javascript-hint.js" ></script>
        <script src="/lib/hint/html-hint.js" ></script>
        <script src="/lib/hint/css-hint.js" ></script>
        <script src="/lib/hint/show-hint.js" ></script>
        <script src="/lib/hint/sql-hint.js" ></script>
        <script src="/lib/hint/xml-hint.js" ></script>
        <script src="/lib/browser.js"></script>

        <style>
            iframe { 
                width: 100%;
                height: 100%;
                border: 1px solid hsl(32, 98%, 52%)
            }
            * {
                margin:0; padding:0; box-sizing: border-box;
            }

            body {
                display: grid;
                grid-template-columns: 1fr 1fr;

                height: 100vh;
            } 

            .CodeMirror {
                width: 100%;
                height: 100vh;
            }

        </style>
    </head>
    <body>
        <textarea id="editor"></textarea>
        <iframe id="result"></iframe>
    </body>
    <script >
        var editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
            lineNumbers: true,
            mode:  { name: "htmlmixed" },
            theme: "dracula",
            extraKeys: {
                "Ctrl-Space": "autocomplete",
                'Tab': 'emmetExpandAbbreviation',
                'Esc': 'emmetResetAbbreviation',
                'Enter': 'emmetInsertLineBreak'
            }
        })

        editor.on('keyup', debounceEvent(handleKeyup))

        function submit_html()
        {
            editor.save();
            var code = document.getElementById("editor").value;
            var data_url = "data:text/html;charset=utf-8;base64," + window.btoa(code);
            console.log(data_url);
            document.getElementById("result").src = data_url;
        }

        function debounceEvent(fn, wait = 1000, time) {
            return (...args) => clearTimeout(time, time = setTimeout(() => fn(...args), wait))
        } 

        function handleKeyup(event) {
            submit_html()
        }

    </script>
</html>
